# Project 2: Automated Data Processing 自动化数据处理

## 引言
当今社会，大部分的工作是通过电脑完成的。  
<br>

电脑可以很高效地帮助我们完成一些任务，尤其是有规律可循的、需要大量重复操作的劳动。  
<br>

这个项目，我们以表格数据处理和自动上报为例，让各位接触操作流程自动化的基本思维。  
<br>

注意：对于表格处理，使用 `Pandas` 库会相当方便。但是，我们希望让大家更多地练习和巩固 `Python` 的**基础语法**，所以请尽量先用基础的 `Python` 实现。完成项目后，如果有余力，可以再去尝试使用 `Pandas` 实现。

## 场景介绍
小明是零下五度市场部门的人员，主要负责售后，包括销售数据数据汇总和客户维系。由于销售量大且市场情况瞬息万变，他需要时刻紧盯微店后台的销售数据。  
<br>

除了与用户进行访谈、根据销售数据撰写汇报等工作外，他还有一个任务：在工作时间，每隔两个小时（整点），需要从微店后台下载一份最新的销售数据表格，经过分析后，向他的上级和库存管理员发送邮件，并向指定用户发送回访问卷。  
<br>

为此，小明制作了一份 `Excel` 表格，通过函数和公式把符合要求的用户过滤出来，然后打开特定网页，将手机号以及邮箱粘贴到制定地方，然后提交。虽然比起手动操作已经快了不少，但是仍然有很多问题：  
- 他每天花费的时间仍然不少；  
- 这个工作总是打断他的思路；  
- 他经常忘记做这件事；  
- 他极有可能误操作，比如下载错文件，少复制了一行等。  
<br>

小明向上级反馈了他的困难。市场部门主管听闻后，找到了你。他之前听说你会 `Python`，觉得你一定可以帮他解决问题。现在正是你大显身手的时候。  
<br>

## 准备工作
请先下载初始代码。
> 初始代码链接在这里

这份代码里有一份名为 `sales.csv` 的表格。这是根据零下五度去年微店销售数据制作出来的一份表单（为了保护真实买家的隐私，我们使用了模拟的数据）。  
<br>

你可以先从处理这份文件开始。在最后，你需要用 `Python` 自动定时下载最新数据（都和这份表格差不多），并且自动完成所有的分析和反馈。  
<br>

完成这个项目后，小明每天就只需要运行一下程序，然后双手离开键盘，让电脑做所有剩下的工作了。  
<br>

那我们现在就开始！


## Section 1：数据的读取

这个部分不需要手写。我们需要大家阅读并理解 `Section 1` 的所有代码，然后尝试运行。如果无法运行，请寻求帮助。  
<br>

另外，请浏览一下表头，大致理解一下数据的每一列大概的意思。  
<br>

每完成一个 `section`，请运行你的 `Python` 文件。我们的自动测试会检测你的结果是否正确。  
<br>

## Section 2：数据统计

这个部分，我们会对表中的数据进行一些简单的统计。  
<br>

首先，我们要实现 `calculateRevenue` 这个函数。  
我们需要分别计算各个单品的销售额。它需要返回一个`字典（Dictionary）`，`索引（key）`是 `商品编码`，`内容（value）`是`总销售额`，像下面这样：  
```python
{'2101': 100000, '2102': 1000000, '2110': 32012451}
```
<br>

然后，我们要实现 `calculateStockReduction` 这个函数。  
我们售卖的是礼包，每种礼包对应指定品种和数量的海鲜，我们需要计算每种海鲜的消耗量，这样库存管理人员可以有所准备。
每种礼包对应的鱼和数量已经在函数中定义好。你需要返回一个 `{品种: 数量}` 组成的`字典`，像下面这样：
```python
{'小黄鱼': 136, '带鱼': 200, '墨鱼': 0, '竹节虾': 300}  # 不止这些种类...
```
<br>


## Section 3：数据提取

这个部分中，我们需要把处在江浙沪地区，而且下单时间与收货时间差别在 3 天以上的用户提取出来。这些用户可能等待了比较长的时间，我们可能需要额外关注，以免造成客户流失。  
<br>

我们需要实现 `getSlowedDelivery` 函数，需要返回一个`字典`，包含所有的用户姓名和手机，格式像下面这样：  
```python
{'小明': 1388888888, '小红': 13567891234, '张三': 13543214321}
```

## Section 4：发送电子邮件
我们需要把前三个 `section` 的输出美化一下（组成一个字符串），通过邮件发送给小明的上级。  
<br>

我们会使用 `Python` 的 `MIMEText` 库来处理邮件，用 `smtplib` 库来发送邮件。  
<br>

作为例子，我们需要各位使用自己的 `QQ` 邮箱，发送邮件到自己的学校邮箱。  
<br>

## Section 5: 定时自动下载和处理
现在，每次运行程序，`Python` 都会自动帮我们处理文件并且发送邮件了。  
<br>

但是，我们仍然需要定时手动去后台下载对应文件，这很麻烦。要真正做到**双手离开键盘**，我们还差最后一步。  
<br>

我们会使用 `sleep` 函数，让程序在后台休眠指定时间，配合一个 `while True` 循环，我们就可以达到定时执行的效果。  
<br>

我们还要使用 `Python` 自带的 `requests` 库，来从指定网址下载文件到本地。  
<br>

后台地址是 `https://icewould.com/m5-101/sales-data`。  
<br>


# 草稿
1. 完成流程：
 - 自动下载 csv 表格
 - 计算并打印总销售额、单品数量
 - 把处在江浙沪地区，而且下单时间与收货时间差别在 3 天以内的用户提取出来
 - 实现隔一段时间自动下载。如果新文件中江浙沪的平均发货时间超过 5 天，向指定手机号发送短信提醒。
 - 如果有人发货时间超过 9 天，额外发送短信，短信内容是所有的订单编号。
 - （额外任务）向服务器提交以上所有信息。


我们会用到：  
- `Python` 基本语法  


`Excel` 中，提供了很多好用的工具，很多比如求和什么的可以一秒搞定；但是，对于一些稍微复杂一点的功能，比如对于某几行，发送特定短信，很多人还在通过雇佣客服的方式


比如，我们有一份记录了客户信息的 `Excel` 表。当然，如果要计算平均销量或者总销量，我们可以直接一秒搞定（`Excel` 给我们定义好了很多好用的操作）；然是，对于稍微复杂一点的功能，比如对于满足某些条件的客户，我们希望通过短信的方式进行回访，并且向市场人员发送邮件提示。
<br>


