<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IceWould Training Hub">
    <meta name="author" content="IceWould Training Team Led by Chonghan Chen">
    <link rel="canonical" href="https://paulcccccch.github.io/content/files-and-formats/">
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>文件和格式 - m5-101</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="../..">m5-101</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../home/">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../..">Schedule</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notes <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../introduction/">Introduction</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notebook Pages <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../hello-world/">Hello World</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://github.com/PaulCCCCCCH/m5-101/edit/master/docs/content/files-and-formats.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#_1">文件和格式</a></li>
            <li class="second-level"><a href="#_2">程序的组成</a></li>
                
            <li class="second-level"><a href="#_3">数据的本质</a></li>
                
            <li class="second-level"><a href="#python">Python 中的实现</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="_1">文件和格式</h1>
<p>当你使用电脑（<code>Windows</code> 或者 <code>macOS</code> 操作系统）或手机（<code>Android</code> 或者 <code>iOS</code> 操作系统）点击打开一个文件的时候，有没有想过，这中间发生了什么呢？<br />
<br></p>
<p>你有没有想过，<code>.jpg</code> 和 <code>.png</code> 文件到底是什么，有什么区别？<br />
<br></p>
<p>为了处理数据，我们可能得先知道一下这些原理。  </p>
<h2 id="_2">程序的组成</h2>
<p>首先，请回顾一下我们在<a href="../basic-concepts">基本概念</a>中提到的，计算机只能接受 <code>1</code> 和 <code>0</code> （二进制）组成的指令（机器码）。任何语言书写的程序，都会被先翻译成 <code>1</code> 和 <code>0</code> 组成的指令，然后才能执行。<br />
<br></p>
<p>但是，程序不只包含指令，还包含数据。让我们拿王者荣耀（一个超级复杂的程序）作为例子：<br />
<br></p>
<p>当你被打了一下，你会损失生命值，我们来猜测一下它的实现方式。<br />
<br></p>
<p>注意以下几点：<br />
- 这可以看作是不能运行的 <code>伪代码</code>，或者代码框架，用来给人读，而不能直接运行；<br />
- 程序里有很多我们并没有定义的函数，大家可以根据函数名猜测一下它大概是做什么的。这是很重要的<strong>抽象</strong>思想，在之后我们会讲解到；<br />
- 类似于 <code>victim.getArmor()</code> 这样的语法，可以类比一下字符串的 <code>someString.split()</code>。<code>someString.split()</code> 会把 <code>someString</code> 拿过来作为参数，然后输出相关的东西（分割好的字符串列表）；同理，<code>victim.getArmor()</code> 会把 <code>victim</code> 变量拿来作为参数，输出 <code>victim</code> 的当前护甲；<br />
- 我们只考虑物理伤害；<br />
<br></p>
<pre><code class="language-python">def calculateRealDamage(baseDamage, armorPenFlat, armorPenPercent, armor):
    &quot;&quot;&quot;
    根据伤害和护甲计算真实伤害
    baseDamage: 技能描述上写的基础伤害
    armorPenFlat: armor penetration flat，攻击者的固定护甲穿透
    armorPenPercent: armor penetration percent，攻击者的百分比护甲穿透
    armor: 被攻击者的护甲
    &quot;&quot;&quot; 
    realArmor = (armor - armorPenFlat) - armor * armorPenPercent # 经过穿透后的剩余护甲
    damageReduction = realArmor / (realArmor + 600) # 伤害减免的比例

    realDamage = damage * (1 - damageReduction)
    return realDamage

def attack(attacker, ability, victim):
    &quot;&quot;&quot;
    attacker: 攻击的人
    ability: 攻击的人使用的技能
    victim: 被攻击的人
    &quot;&quot;&quot;
    baseDamage = ability.getDamage(attacker) # 根据攻击者的属性计算技能基础伤害
    realDamage = calculateRealDamage(baseDamage, attacker.getArmorPenFlat() ,attacker.getArmorPenPercent(), victim.getArmor()) # 调用 calculateRealDamage 计算真实的伤害

    life = victim.getLife() # 获取被攻击者生命值
    newLife = life - realDamage
    if newLife &lt;= 0:  # 如果被攻击者生命值降到 0 以下
        victim.setLife(0)
        victim.die()       
    else:
        victim.setLife(newLife) # 玩家的生命值变为一个新的值（被扣除了一些）
    return 
</code></pre>
<p>之后，这段代码会被翻译成 <code>1</code> 和 <code>0</code> 组成的一连串指令，储存在你的手机上。<br />
每当你玩游戏，有攻击事件发生的时候，这段指令就会被执行。<br />
<br></p>
<p>但是，除了<strong>指令</strong>之外，你的手机还有别的东西要储存：这就是<strong>数据</strong>。<br />
<br> </p>
<p>让我们来看一下 <code>victim.die()</code> 这个函数。有一些面向对象的方法（比如 <code>class</code> 等），我们暂时不需要掌握。</p>
<pre><code class="language-python">import soundLibrary
class Player: # victim 就是一个 Player

    def die(self):
        &quot;&quot;&quot;
        英雄阵亡时播放英雄专属的阵亡音效
        &quot;&quot;&quot;
        with open(self.getSoundFilePath(), 'rb') as f: 
        # self.getSoundFilePath() 可能返回类似于 'Libai-die-2.wav' 这样的字符串
            soundWave = soundLibrary.process(f) # 把声音处理成可以播放的
            soundLibrary.play(soundWave) # 播放英雄专属的阵亡音效

    #####################
    ## 可能还有很多其它函数...
    #####################


</code></pre>
<p><br></p>
<p>这里，<code>f</code> 就是二进制的声音文件，它是和整个游戏一起被下载到你的手机里，并储存起来的。我们管这样的东西叫做 <code>数据</code>。<br />
<br> </p>
<p>事实上，好几个 <code>GB</code> 大小的王者荣耀游戏文件中，<code>指令</code> 可能只占了不到百分之一，剩下的全部都是图片、音频、文字、模型等等<code>数据</code>，这些 <code>数据</code> 需要在运行的时候被读取、处理、展示。<br />
（当然，<code>die</code> 函数的逻辑肯定不是上面这样，因为每次有英雄阵亡都重新读文件非常非常耗时（读取文件是相当慢的操作），一定是加载游戏的时候读出来，然后反复使用的）</p>
<h2 id="_3">数据的本质</h2>
<p>那么，这些数据是怎么保存在电脑上的呢？<br />
<br></p>
<p>和指令一样，它也是以二进制的形式保存的。对电脑来说，硬盘里的存储介质被磁化就代表 <code>1</code>，否则就是 <code>0</code>。<br />
<br></p>
<p>我们要存储的信息（比如一个图片）先是以一定规则被 <code>编码</code> 成二进制（比如，规定好，文件的每 <code>24</code> 位二进制数代表一个像素的 <code>RGB</code> 值，用这种方式保存图片），存储下来，用到的时候，再用对应的 <code>解码</code> 方式还原出来。我们可以用任何方法 <code>解码</code> 任何数据，只不过解出来的东西会让人不知所云。比如，对一个 <code>.doc</code> 文件（<code>word</code> 文档），你可以选择<code>使用记事本打开</code>，然后会看到一堆乱码，这就是所谓的 <strong>打开方式不对</strong>。<br />
<br></p>
<p><code>.doc</code>，<code>.docx</code>，<code>.jpg</code> 等拓展名，只是用来标明文件的类型，告诉人们需要用什么方式来 <code>解码</code>的，并没有什么实际的作用。当然，现在的 <code>Windows</code> 系统会根据对应的拓展名自动选择解码方式（指定默认打开方式），所以会出现更改拓展名之后无法打开的情况。当然，你可以强行把一个 <code>.jpg</code> 文件的拓展名改成 <code>.doc</code>，然后手动选择用图片查看器打开，这完全没有问题。<br />
<br></p>
<h2 id="python">Python 中的实现</h2>
<p><code>Python</code> 中的 <code>open</code> 函数，会返回一个变量。这个变量本身并不包含任何内容，它只是一个读取文件用的“窗口”，我们可以通过这个变量读取文件内容。
<br> </p>
<p>通常情况下，对于文本文件（就是使用记事本打开，能直接看到文字内容，而不是乱码的东西），我们使用 <code>open(filename)</code>，对于非文本（图片、音频等），我们使用 <code>open(filename, 'rb')</code>。<br />
<br></p>
<p>用 <code>open</code> 打开一个 <code>txt</code> 文件，并且调用 <code>readlines</code>，你可以看到它的内容。  </p>
<pre><code class="language-python">f = open(&quot;txtFile.txt&quot;)
print(f.readlines())
</code></pre>
<p>你可以试试用它来打开其它格式的文件。你会发现，大多数情况下会得到乱码。这是因为，<code>readlines()</code> 会从字面意思上读取文件（得到二进制码），而 <code>print</code> 会尝试把它 <code>解码</code> 成英文字符。然而，由于它实际上是其它东西，所以 <code>解码</code> 出来的东西会不知所云。<br />
<br></p>
<p>想要读取特定类型的文件，我们需要与文件匹配的 <code>解码</code> 方法。在 <code>Python</code> 中，我们可以使用第三方库来解决。 <br />
比如，如果你想读取一个图片并展示出来，你可以使用 <code>Pillow</code> 这个库。<br />
<br></p>
<pre><code class="language-python">import PIL
from PIL import Image
image = Image.open(&quot;yazi.jpg&quot;) # 这个函数其实先使用了 Python 的 open 函数，然后进行解码。
# 希望深究的同学可以看一下它的源码　https://pillow.readthedocs.io/en/stable/_modules/PIL/Image.html#open
image.show()    # 这句段代码可以打开一个新的窗口来展示图片。
                # 你也可以直接通过 image 变量读取或修改每一个像素点。
</code></pre></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="../../assets/mathjaxhelper.js"></script>

    <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
