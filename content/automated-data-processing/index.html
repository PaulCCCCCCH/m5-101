<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IceWould Training Hub">
    <meta name="author" content="IceWould Training Team Led by Chonghan Chen">
    <link rel="canonical" href="https://paulcccccch.github.io/content/automated-data-processing/">
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>Project 2: Automated Data Processing 自动化数据处理 - m5-101</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="../..">m5-101</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../home/">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../..">Schedule</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notes <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../introduction/">Introduction</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notebook Pages <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../hello-world/">Hello World</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://github.com/PaulCCCCCCH/m5-101/edit/master/docs/content/automated-data-processing.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#project-2-automated-data-processing">Project 2: Automated Data Processing 自动化数据处理</a></li>
            <li class="second-level"><a href="#_1">引言</a></li>
                
            <li class="second-level"><a href="#_2">场景介绍</a></li>
                
            <li class="second-level"><a href="#_3">准备工作</a></li>
                
            <li class="second-level"><a href="#section-1">Section 1：数据的读取</a></li>
                
            <li class="second-level"><a href="#section-2">Section 2：数据统计</a></li>
                
            <li class="second-level"><a href="#section-3">Section 3：数据提取</a></li>
                
            <li class="second-level"><a href="#section-4">Section 4：发送电子邮件</a></li>
                
            <li class="second-level"><a href="#section-5">Section 5: 定时自动下载和处理</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="project-2-automated-data-processing">Project 2: Automated Data Processing 自动化数据处理</h1>
<h2 id="_1">引言</h2>
<p>当今社会，大部分的工作是通过电脑完成的。<br />
<br></p>
<p>电脑可以很高效地帮助我们完成一些任务，尤其是有规律可循的、需要大量重复操作的劳动。<br />
<br></p>
<p>这个项目，我们以表格数据处理和自动上报为例，让各位接触操作流程自动化的基本思维。<br />
<br></p>
<p>注意：对于表格处理，使用 <code>Pandas</code> 库会相当方便。但是，我们希望让大家更多地练习和巩固 <code>Python</code> 的<strong>基础语法</strong>，所以请尽量先用基础的 <code>Python</code> 实现。完成项目后，如果有余力，可以再去尝试使用 <code>Pandas</code> 实现。</p>
<h2 id="_2">场景介绍</h2>
<p>小明是零下五度市场部门的人员，主要负责售后，包括销售数据数据汇总和客户维系。由于销售量大且市场情况瞬息万变，他需要时刻紧盯微店后台的销售数据。<br />
<br></p>
<p>除了与用户进行访谈、根据销售数据撰写汇报等工作外，他还有一个任务：在工作时间，每隔两个小时（整点），需要从微店后台下载一份最新的销售数据表格，经过分析后，向他的上级和库存管理员发送邮件，并向指定用户发送回访问卷。<br />
<br></p>
<p>为此，小明制作了一份 <code>Excel</code> 表格，通过函数和公式把符合要求的用户过滤出来，然后打开特定网页，将手机号以及邮箱粘贴到制定地方，然后提交。虽然比起手动操作已经快了不少，但是仍然有很多问题：<br />
- 他每天花费的时间仍然不少；<br />
- 这个工作总是打断他的思路；<br />
- 他经常忘记做这件事；<br />
- 他极有可能误操作，比如下载错文件，少复制了一行等。<br />
<br></p>
<p>小明向上级反馈了他的困难。市场部门主管听闻后，找到了你。他之前听说你会 <code>Python</code>，觉得你一定可以帮他解决问题。现在正是你大显身手的时候。<br />
<br></p>
<h2 id="_3">准备工作</h2>
<p>请先下载初始代码。<br />
<a href="../code/automated-data-processing.zip">下载链接</a><br />
<br></p>
<p>这份代码里有一份名为 <code>sales.csv</code> 的表格。这是根据零下五度去年微店销售数据制作出来的一份表单（为了保护真实买家的隐私，我们使用了模拟的数据）。<br />
<br></p>
<p>你可以先从处理这份文件开始。在最后，你需要用 <code>Python</code> 自动定时下载最新数据（都和这份表格差不多），并且自动完成所有的分析和反馈。<br />
<br></p>
<p>完成这个项目后，小明每天就只需要运行一下程序，然后双手离开键盘，让电脑做所有剩下的工作了。<br />
<br></p>
<p>那我们现在就开始！</p>
<h2 id="section-1">Section 1：数据的读取</h2>
<p>这个部分不需要手写。我们需要大家阅读并理解 <code>Section 1</code> 的所有代码，然后尝试运行。如果无法运行，请寻求帮助。<br />
<br></p>
<p>另外，请浏览一下表头，大致理解一下数据的每一列大概的意思。<br />
<br></p>
<h2 id="section-2">Section 2：数据统计</h2>
<p>这个部分，我们会对表中的数据进行一些简单的统计。<br />
<br></p>
<p>首先，我们要实现 <code>calculateRevenue</code> 这个函数。<br />
我们需要分别计算各个单品的销售额。它需要返回一个<code>字典（Dictionary）</code>，<code>索引（key）</code>是 <code>商品编码</code>，<code>内容（value）</code>是<code>总销售额</code>。用我们初始代码提供的（不是自动下载的） <code>sales.csv</code> 文件，运行结果如下。</p>
<pre><code class="language-python">{'2110': 886574, '2102': 693680, '2101': 383145}
</code></pre>
<p><br></p>
<p>然后，我们要实现 <code>calculateStockReduction</code> 这个函数。<br />
我们售卖的是礼包，每种礼包对应指定品种和数量的海鲜，我们需要计算每种海鲜的消耗量，这样库存管理人员可以有所准备。
每种礼包对应的鱼和数量已经在函数中定义好（<code>giftContent</code> 变量）。你需要返回一个 <code>{品种: 数量}</code> 组成的<code>字典</code>，结果应该是：  </p>
<pre><code class="language-python">{'舟山带鱼': 600, '野生小黄鱼': 194, '野生竹节虾': 600, '舟山米鱼': 392, '红果鲤': 196, '舟山乌贼': 392, '舟山黄鱼': 406}

</code></pre>
<p><br></p>
<h2 id="section-3">Section 3：数据提取</h2>
<p>这个部分中，我们需要把处在江浙沪地区，而且下单时间与收货时间差别在 3 天以上的用户提取出来。这些用户可能等待了比较长的时间，我们可能需要额外关注，以免造成客户流失。<br />
<br></p>
<p>我们需要实现 <code>getSlowedDelivery</code> 函数，需要返回一个<code>字典</code>，包含所有的订单编号，以及对应的<code>用户姓名+空格+手机</code>（注意，都是字符串），结果应该是：  </p>
<pre><code class="language-python">{'81417556230447': '周桂芝 15708740139', '81417556230776': '彭磊 13944167948', '81417556231556': '陈林 15108016839', '81417556230909': '李杰 13777697578', '81417556232786': '赵浩 15627748610', '81417556231346': '胡华 15333751374', '81417556232766': '陈坤 13364097050', '81417556231432': '汤建平 13270650569', '81417556230174': '向梅 15108373401', '81417556232685': '田瑞 15936746224'}
</code></pre>
<p><br></p>
<h2 id="section-4">Section 4：发送电子邮件</h2>
<p>我们需要把前三个 <code>section</code> 的输出美化一下（组成一个字符串），通过邮件发送给小明的上级。<br />
<br></p>
<p>我们会使用 <code>Python</code> 的 <code>MIMEText</code> 库来处理邮件，用 <code>smtplib</code> 库来发送邮件。<br />
<br></p>
<p>作为例子，我们需要各位使用自己的 <code>QQ</code> 邮箱，发送邮件到自己的学校邮箱。<br />
<br></p>
<p>由于我们在使用 <code>QQ</code> 邮箱的邮件服务器，我们需要拿到 <code>QQ</code> 邮箱的授权码。具体操作如下：<br />
1. 登录网页版 <code>QQ</code> 邮箱
2. 点击最上方的 <code>设置</code>
3. 点击邮箱设置下的 <code>账户</code> 标签
4. 下拉到 <code>POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务</code> 标签
5. 点击 <code>POP3/SMTP服务</code> 后面的 <code>开启</code>
6. 把出现的授权码复制给代码中的 <code>code</code> 变量。</p>
<p>完成这个 <code>Section</code> 之后，记得把 <code>main</code> 函数里的 <code>sendEmails()</code> 函数调用这一行从注释里拿出来，并且确认自己确实收到了邮件。<br />
<br></p>
<h2 id="section-5">Section 5: 定时自动下载和处理</h2>
<p>现在，每次运行程序，<code>Python</code> 都会自动帮我们处理文件并且发送邮件了。<br />
<br></p>
<p>但是，我们仍然需要定时手动去后台下载对应文件，这很麻烦。要真正做到<strong>双手离开键盘</strong>，我们还差最后一步。<br />
<br></p>
<p>我们会使用 <code>sleep</code> 函数，让程序在后台休眠指定时间，配合一个 <code>while True</code> 循环，我们就可以达到定时执行的效果。<br />
为了测试，请把 <code>sleep</code> 的时间设置成 <code>30</code>（秒）。<br />
<br></p>
<p>我们还要使用 <code>Python</code> 的第三方 <code>requests</code> 库，来从指定网址下载文件到本地。<br />
你需要在命令行输入 <code>pip install requests</code>，然后等待它安装完成。<br />
对于安装第三方库的详细解释，我们之后会讲到。
<br></p>
<p>下载文件的后台地址是 <code>https://icewould.com/m5-101/sales-data</code>。<br />
<br></p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="../../assets/mathjaxhelper.js"></script>

    <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
